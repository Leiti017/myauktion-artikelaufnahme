<!doctype html>
<html lang="de">
<head>
  <!-- build:ARTICLES_20251217 -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MyAuktion · Gesamtartikel</title>
  
  <!-- FAVICONS & APP ICONS -->
  <link rel="icon" href="/static/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/static/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/static/android-chrome-512x512.png">
  <meta name="theme-color" content="#1d4ed8">

<script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{min-height:100vh;background:linear-gradient(135deg,#0ea5e9,#1d4ed8 60%,#1e293b);color:#fff}
    .glass{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.16);backdrop-filter:blur(12px)}
    .input{width:100%;padding:.55rem .8rem;border-radius:.8rem;border:1px solid rgba(255,255,255,.35);background:#fff;color:#000}
    .btn{padding:.55rem 1rem;border-radius:999px;font-weight:700}
    .btn-primary{background:#fff;color:#0f172a;box-shadow:0 8px 18px rgba(0,0,0,.2)}
  </style>
</head>
<body>
<div class="max-w-7xl mx-auto px-4 py-6">
  <header class="flex items-center justify-between mb-6">
    <div>
      <div class="text-2xl font-extrabold">MyAuktion · Gesamtartikel</div>
      <div class="text-xs opacity-80">Neueste zuerst · Filter nach Datum</div>
    </div>
    <div class="flex gap-3">
      <a href="/" class="underline text-sm opacity-90">Artikelaufnahme</a>
      <a href="/admin" class="underline text-sm opacity-90">Admin</a>
    </div>
  </header>

  <section class="glass rounded-3xl p-5 shadow-xl mb-5">
    <div class="grid md:grid-cols-3 gap-3 items-end">
      <div>
        <label class="text-xs opacity-80">Von (Aufnahmedatum)</label>
        <input id="from" type="date" class="input">
      </div>
      <div>
        <label class="text-xs opacity-80">Bis (Aufnahmedatum)</label>
        <input id="to" type="date" class="input">
      </div>
      <div class="flex gap-2">
        <button id="btn" class="btn btn-primary w-full" type="button">Filtern</button>
        <button id="btn-reset" class="btn btn-primary w-full" type="button">Reset</button>
      </div>
    </div>
    <div class="text-[11px] opacity-70 mt-2">Tipp: Leer lassen = alle Artikel.</div>
  </section>

  <section class="glass rounded-3xl p-5 shadow-xl">
    <div class="flex items-center justify-between gap-3">
      <div class="text-lg font-bold">Liste</div>
      <div id="count" class="text-sm opacity-90">–</div>
    </div>

    <div class="overflow-x-auto mt-4">
      <table class="w-full text-sm">
        <thead class="text-left opacity-90">
          <tr>
            <th class="py-2 pr-3">Bild</th>
            <th class="py-2 pr-3">Datum</th>
            <th class="py-2 pr-3">ArtikelNr</th>
            <th class="py-2 pr-3">Sortiment</th>
            <th class="py-2 pr-3">Bezeichnung</th>
            <th class="py-2 pr-3">Menge</th>
            <th class="py-2 pr-3">Rufpreis</th>
            <th class="py-2 pr-3">Lagerort</th>
            <th class="py-2 pr-3">Mitarbeiter</th>
          </tr>
        </thead>
        <tbody id="rows" class="align-top"></tbody>
      </table>
    </div>
  </section>
</div>

<script>
  const elFrom = document.getElementById('from');
  const elTo = document.getElementById('to');
  const btn = document.getElementById('btn');
  const btnReset = document.getElementById('btn-reset');
  const rows = document.getElementById('rows');
  const count = document.getElementById('count');

  function money(v){
    const n = Number(v||0);
    if(!n) return "";
    return (Math.round(n*100)/100).toFixed(2).replace(".", ",");
  }
  function dt(ts){
    const n = Number(ts||0);
    if(!n) return "";
    const d = new Date(n*1000);
    return d.toLocaleString();
  }

  async function load(){
    const qs = new URLSearchParams();
    if(elFrom.value) qs.set('date_from', elFrom.value);
    if(elTo.value) qs.set('date_to', elTo.value);
    const res = await fetch('/api/articles' + (qs.toString()?('?'+qs.toString()):''));
    const j = await res.json();
    const items = (j.items||[]);
    count.textContent = items.length + " Artikel";

    rows.innerHTML = items.map(it=>{
      const img = it.image ? `<img src="${it.image}" style="height:54px;border-radius:12px;border:1px solid rgba(255,255,255,.25)">` : '';
      return `
        <tr class="border-t border-white/15">
          <td class="py-2 pr-3">${img}</td>
          <td class="py-2 pr-3 text-xs opacity-90">${dt(it.created_at)}</td>
          <td class="py-2 pr-3 font-bold">${it.artikelnr}</td>
          <td class="py-2 pr-3">${(it.sortiment||"")}</td>
          <td class="py-2 pr-3">${String(it.titel||"").replaceAll("<","&lt;")}</td>
          <td class="py-2 pr-3">${it.menge ?? 1}</td>
          <td class="py-2 pr-3">${money(it.rufpreis)}</td>
          <td class="py-2 pr-3">${String(it.lagerort||"").replaceAll("<","&lt;")}</td>
          <td class="py-2 pr-3">${(it.mitarbeiter||"")}</td>
        </tr>
      `;
    }).join("");
  }

  btn.onclick = load;
  btnReset.onclick = ()=>{
    elFrom.value = "";
    elTo.value = "";
    load();
  };

  load();
</script>
</body>
</html>
