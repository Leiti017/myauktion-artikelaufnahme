<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>MyAuktion · Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-900 text-white">

<div class="max-w-5xl mx-auto px-4 py-6">

  <header class="flex items-center justify-between mb-6">
    <div class="text-xl font-bold">MyAuktion · Admin</div>
    <a href="/" class="underline text-sm opacity-80">← zurück</a>
  </header>

  <!-- LOGIN -->
  <section id="login-box" class="bg-slate-800 rounded-xl p-5 max-w-md mx-auto">
    <h2 class="font-semibold mb-3">Admin Zugriff</h2>
    <input id="token" type="password" placeholder="Admin Token"
           class="w-full p-2 rounded text-black mb-3">
    <button id="btn-login"
            class="bg-white text-slate-900 font-semibold px-4 py-2 rounded w-full">
      Anmelden
    </button>
    <div id="login-error" class="text-red-400 text-sm mt-2 hidden">
      Ungültiger Token
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="dashboard" class="hidden">

    <div class="grid md:grid-cols-3 gap-4 mb-6">
      <div class="bg-slate-800 rounded-xl p-4">
        <div class="text-sm opacity-70">Artikel gesamt</div>
        <div id="stat-articles" class="text-2xl font-bold">–</div>
      </div>

      <div class="bg-slate-800 rounded-xl p-4">
        <div class="text-sm opacity-70">KI erfolgreich</div>
        <div id="stat-ok" class="text-2xl font-bold text-green-400">–</div>
      </div>

      <div class="bg-slate-800 rounded-xl p-4">
        <div class="text-sm opacity-70">KI fehlgeschlagen</div>
        <div id="stat-fail" class="text-2xl font-bold text-red-400">–</div>
      </div>
    </div>

    <div class="bg-slate-800 rounded-xl p-5">
      <h3 class="font-semibold mb-2">KI Budget / Nutzung</h3>
      <div class="text-sm opacity-80 mb-1">
        (Schätzung basierend auf API-Aufrufen)
      </div>
      <div id="budget" class="text-2xl font-bold">–</div>
    </div>

  </section>

</div>

<script>
const loginBox = document.getElementById("login-box");
const dash = document.getElementById("dashboard");
const err = document.getElementById("login-error");

document.getElementById("btn-login").onclick = async () => {
  const token = document.getElementById("token").value.trim();
  if (!token) return;

  const res = await fetch("/api/admin/stats", {
    headers: { "X-ADMIN-TOKEN": token }
  });

  if (!res.ok) {
    err.classList.remove("hidden");
    return;
  }

  const j = await res.json();
  loginBox.classList.add("hidden");
  dash.classList.remove("hidden");

  document.getElementById("stat-articles").textContent = j.articles;
  document.getElementById("stat-ok").textContent = j.ki_ok;
  document.getElementById("stat-fail").textContent = j.ki_fail;
  document.getElementById("budget").textContent =
    j.estimated_cost.toFixed(2) + " €";
};
</script>

</body>
</html>
