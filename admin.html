<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>MyAuktion · Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-900 text-white">

<div class="max-w-5xl mx-auto px-4 py-6">

  <header class="flex items-center justify-between mb-6">
    <div class="text-xl font-bold">MyAuktion · Admin</div>
    <a href="/" class="underline text-sm opacity-80">← zurück</a>
  </header>

  <!-- LOGIN -->
  <section id="login" class="bg-slate-800 rounded-xl p-5 max-w-md mx-auto">
    <h2 class="font-semibold mb-3">Admin Zugriff</h2>
    <input id="token" type="password" placeholder="Admin Token"
           class="w-full p-2 rounded text-black mb-3">
    <button id="btn-login"
            class="bg-white text-slate-900 font-semibold px-4 py-2 rounded w-full">
      Anmelden
    </button>
    <div id="err" class="text-red-400 text-sm mt-2 hidden">
      Ungültiger Token
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="dash" class="hidden">

    <!-- BUDGET -->
    <div class="grid md:grid-cols-3 gap-4 mb-6">
      <div class="bg-slate-800 rounded-xl p-4">
        <div class="text-sm opacity-70">Budget</div>
        <div id="b-budget" class="text-2xl font-bold">–</div>
      </div>
      <div class="bg-slate-800 rounded-xl p-4">
        <div class="text-sm opacity-70">Verbraucht (Schätzung)</div>
        <div id="b-spent" class="text-2xl font-bold text-yellow-400">–</div>
      </div>
      <div class="bg-slate-800 rounded-xl p-4">
        <div class="text-sm opacity-70">Restbudget</div>
        <div id="b-rest" class="text-2xl font-bold text-green-400">–</div>
      </div>
    </div>

    <!-- KI STATUS -->
    <div class="bg-slate-800 rounded-xl p-5 mb-6">
      <h3 class="font-semibold mb-3">KI Status</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div>
          <div class="text-xs opacity-70">Erfolgreich</div>
          <div id="b-ok" class="text-xl font-bold text-green-400">–</div>
        </div>
        <div>
          <div class="text-xs opacity-70">Fehlgeschlagen</div>
          <div id="b-fail" class="text-xl font-bold text-red-400">–</div>
        </div>
        <div>
          <div class="text-xs opacity-70">Kosten / Call</div>
          <div id="b-cost" class="text-xl font-bold">–</div>
        </div>
      </div>
    </div>

    <!-- ARTIKEL -->
    <div class="bg-slate-800 rounded-xl p-5">
      <h3 class="font-semibold mb-3">Artikelübersicht</h3>
      <div id="list" class="text-sm space-y-2"></div>
    </div>

  </section>

</div>

<script>
const login = document.getElementById("login");
const dash  = document.getElementById("dash");
const err   = document.getElementById("err");
let TOKEN = "";

document.getElementById("btn-login").onclick = async () => {
  TOKEN = document.getElementById("token").value.trim();
  if (!TOKEN) return;

  const h = { "X-Admin-Token": TOKEN };

  // Budget
  const b = await fetch("/api/admin/budget", { headers: h });
  if (!b.ok) { err.classList.remove("hidden"); return; }
  const bj = await b.json();

  // Artikel
  const a = await fetch("/api/admin/articles", { headers: h });
  const aj = await a.json();

  login.classList.add("hidden");
  dash.classList.remove("hidden");

  document.getElementById("b-budget").textContent = bj.budget_eur.toFixed(2) + " €";
  document.getElementById("b-spent").textContent  = bj.spent_est_eur.toFixed(2) + " €";
  document.getElementById("b-rest").textContent   = bj.remaining_est_eur.toFixed(2) + " €";
  document.getElementById("b-ok").textContent     = bj.success_calls;
  document.getElementById("b-fail").textContent   = bj.failed_calls;
  document.getElementById("b-cost").textContent   = bj.cost_per_success_call_eur + " €";

  const list = document.getElementById("list");
  list.innerHTML = "";
  aj.items.forEach(it => {
    const div = document.createElement("div");
    div.className = "border-b border-white/10 pb-1";
    div.innerHTML =
      `<b>${it.artikelnr}</b> · ${it.titel || "(kein Titel)"}<br>
       <span class="opacity-70">
         KI: ${it.ki_source} · Preis: ${it.retail_price} € → ${it.rufpreis} €
       </span>`;
    list.appendChild(div);
  });
};
</script>

</body>
</html>
